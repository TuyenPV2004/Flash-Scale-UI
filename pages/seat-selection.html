<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chọn ghế - FlashTicket</title>
    <link rel="stylesheet" href="../assets/css/global.css" />
    <link rel="stylesheet" href="../assets/css/seat-selection.css" />
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
  </head>
  <body>
    <header class="header-nav">
      <div class="header-map-section">
        <div class="header-left">
          <a
            href="booking.html"
            style="font-size: 20px; color: var(--text-white)"
            ><i class="ph-bold ph-arrow-left"></i
          ></a>
          <span style="font-weight: 700; font-size: 18px"
            >Chọn vị trí ngồi</span
          >
        </div>

        <div class="header-legend">
          <div class="legend-item">
            <div class="seat-dot available"></div>
            Trống
          </div>
          <div class="legend-item">
            <div class="seat-dot selected"></div>
            Đang chọn
          </div>
          <div class="legend-item">
            <div class="seat-dot sold"></div>
            Đã bán
          </div>
        </div>
      </div>

      <div class="header-sidebar-section">
        <div
          class="header-right"
          style="font-size: 14px; color: var(--text-gray)"
        >
          Thời gian giữ ghế:
          <span style="color: #ef4444; font-weight: 700; margin-left: 8px"
            >09:45</span
          >
        </div>
      </div>
    </header>

    <div class="seat-layout">
      <div class="main-map-area">
        <div class="map-viewport" id="viewport">
          <div class="map-container" id="mapContainer">
            <div class="stage-area">STAGE</div>

            <!-- Khu 1: VIP (A, B) -->
            <div class="zone-block zone-vip" data-zone-label="KHU VỰC VIP">
              <div class="seat-grid">
                <div class="row">
                  <div class="row-label">A</div>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 5000000, 'A1')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 5000000, 'A2')"
                  ></button>
                  <button class="seat-btn sold"></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 5000000, 'A4')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 5000000, 'A5')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 5000000, 'A6')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 5000000, 'A7')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 5000000, 'A8')"
                  ></button>
                </div>
                <div class="row">
                  <div class="row-label">B</div>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 5000000, 'B1')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 5000000, 'B2')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 5000000, 'B3')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 5000000, 'B4')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 5000000, 'B5')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 5000000, 'B6')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 5000000, 'B7')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 5000000, 'B8')"
                  ></button>
                </div>
              </div>
            </div>

            <!-- Khu 2: Tiêu chuẩn (C -> M) -->
            <div
              class="zone-block zone-standard"
              data-zone-label="KHU VỰC TIÊU CHUẨN"
            >
              <div class="seat-grid">
                <!-- Rows C through M -->
                <script>
                  const standardRows = [
                    "C",
                    "D",
                    "E",
                    "F",
                    "G",
                    "H",
                    "I",
                    "J",
                    "K",
                    "L",
                    "M",
                  ];
                  standardRows.forEach((rowTitle) => {
                    document.write(`
                                        <div class="row">
                                            <div class="row-label">${rowTitle}</div>
                                            ${Array(10)
                                              .fill(0)
                                              .map(
                                                (_, i) =>
                                                  `<button class="seat-btn available" onclick="toggleSeat(this, 3500000, '${rowTitle}${i + 1}')"></button>`,
                                              )
                                              .join("")}
                                        </div>
                                    `);
                  });
                </script>
              </div>
            </div>

            <!-- Khu 3: Cơ bản (N) -->
            <div class="zone-block zone-basic" data-zone-label="KHU VỰC CƠ BẢN">
              <div class="seat-grid">
                <div class="row">
                  <div class="row-label">N</div>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 2500000, 'N1')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 2500000, 'N2')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 2500000, 'N3')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 2500000, 'N4')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 2500000, 'N5')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 2500000, 'N6')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 2500000, 'N7')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 2500000, 'N8')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 2500000, 'N9')"
                  ></button>
                  <button
                    class="seat-btn available"
                    onclick="toggleSeat(this, 2500000, 'N10')"
                  ></button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="toolbox">
          <button class="tool-btn" onclick="zoom(0.1)">
            <i class="ph-bold ph-plus"></i>
          </button>
          <button class="tool-btn" onclick="zoom(-0.1)">
            <i class="ph-bold ph-minus"></i>
          </button>
          <button class="tool-btn" onclick="resetZoom()">
            <i class="ph-bold ph-arrows-out"></i>
          </button>
        </div>
      </div>

      <aside class="sidebar-summary">
        <div class="event-info-card">
          <img
            src="https://salt.tkbcdn.com/ts/ds/b8/e6/a3/9d3a2c5a55034767ca29d32caa3ac874.jpeg"
            class="event-thumb-mini"
          />
          <h2>[The Grand Ho Tram] Stay & Concert: HỒ NGỌC HÀ</h2>
          <div class="text-mute">
            <i class="ph-fill ph-calendar-blank"></i> 07/02/2026 - 20:00
          </div>
          <div class="text-mute">
            <i class="ph-fill ph-map-pin"></i> Ấp Hồ Tràm, Xã Hồ Tràm, Thành phố
            Hồ Chí Minh
          </div>
        </div>

        <div class="price-list">
          <h3 style="font-size: 16px; margin-bottom: 16px">Hạng vé</h3>
          <div class="price-item">
            <span
              ><span class="zone-indicator" style="background: #facc15"></span
              >VÉ VIP</span
            >
            <strong>5.000.000 ₫</strong>
          </div>
          <div class="price-item">
            <span
              ><span class="zone-indicator" style="background: #d946ef"></span
              >VÉ TIÊU CHUẨN</span
            >
            <strong>3.500.000 ₫</strong>
          </div>
          <div class="price-item">
            <span
              ><span class="zone-indicator" style="background: #2dd4bf"></span
              >VÉ CƠ BẢN</span
            >
            <strong>2.500.000 ₫</strong>
          </div>
        </div>

        <div class="sidebar-footer">
          <div
            style="
              display: flex;
              justify-content: space-between;
              margin-bottom: 12px;
              font-size: 14px;
            "
          >
            <span class="text-mute">Đã chọn:</span>
            <strong id="seatCount">0</strong>
          </div>

          <button
            id="checkoutBtn"
            class="cta-btn"
            onclick="window.location.href = 'checkout.html'"
          >
            <span>Vui lòng chọn ghế</span>
            <span>0 ₫</span>
          </button>
        </div>
      </aside>
    </div>

    <script>
      let currentScale = 1;
      let totalAmount = 0;
      let selectedSeats = [];

      // Zoom Logic
      function zoom(delta) {
        currentScale += delta;
        if (currentScale < 0.5) currentScale = 0.5;
        if (currentScale > 2) currentScale = 2;
        document.getElementById("mapContainer").style.transform =
          `scale(${currentScale})`;
      }
      function resetZoom() {
        currentScale = 1;
        document.getElementById("mapContainer").style.transform = `scale(1)`;
      }

      // Seat Logic
      function toggleSeat(btn, price, seatLabel) {
        if (btn.classList.contains("selected")) {
          // Bỏ chọn
          btn.classList.remove("selected");
          btn.classList.add("available");
          totalAmount -= price;
          selectedSeats = selectedSeats.filter((s) => s !== seatLabel);
        } else {
          // Chọn
          btn.classList.remove("available");
          btn.classList.add("selected");
          totalAmount += price;
          selectedSeats.push(seatLabel);
        }
        updateSidebar();
      }

      function updateSidebar() {
        const seatCountEl = document.getElementById("seatCount");
        if (selectedSeats.length > 0) {
          // Hiển thị danh sách ghế, ví dụ: "C1, D2"
          seatCountEl.innerText = selectedSeats.sort().join(", ");
        } else {
          seatCountEl.innerText = "-";
        }

        const btn = document.getElementById("checkoutBtn");
        const priceText = btn.querySelector("span:last-child");
        const labelText = btn.querySelector("span:first-child");

        priceText.innerText = totalAmount.toLocaleString("vi-VN") + " ₫";

        if (selectedSeats.length > 0) {
          btn.classList.add("active");
          btn.disabled = false;
          labelText.innerText = "Thanh toán ngay";
        } else {
          btn.classList.remove("active");
          btn.disabled = true;
          labelText.innerText = "Vui lòng chọn ghế";
        }
      }
    </script>
  </body>
</html>
